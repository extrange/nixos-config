# My NixOS Configuration

https://github.com/extrange/nixos-config/assets/29305375/d6c1ed13-6e20-4f08-81ee-dac268ea39cf

Each host has 3 files:

- home.nix
- system.nix
- hardware-configuration.nix (generated by `nixos-generate-config`)

An encrypted root + swap ([LVM over LUKS]) will be setup by default.

## Install

> [!IMPORTANT]
> Before installing anything, you will need to back up your existing configuration:
>
> - `~/.ssh` keys
> - Firefox profile directory
> - `/etc/fstab`
> - `nm-cli` connections (if applicable)
> - VM images (if applicable)

Boot into the NixOS [installer].

Setup partitions:

```text
$ sudo -i
# source <(curl -s https://raw.githubusercontent.com/extrange/nixos-config/main/setup-partitions.sh)
```

Follow the necessary instructions, then reboot.

## Post Install

- Login to `git`
- `ssh-copy-id` to `server`
- `git push` changes to `hardware-configuration.nix`
- Setup logins:
  - Tailscale
  - Telegram
  - Whatsapp
- Syncthing: configure folders, add device to server
- GSConnect pairing

## Notes

- `nixos-rebuild switch --flake .#hostname` will not allow access to untracked files. To [work around] this, do `nixos-rebuild switch --flake path:.#hostname`.
- Using `read` in `curl ... | bash` doesn't work as `read` does not have access to the terminal, so `source` is used instead.
- I decided against using `sops-nix` or `agenix` to manage secrets, the reason being that if I am already able to transfer a secret out-of-band (the private key), then I might as well have already sent any other information over the same channel.
  - Also, setting up authentication for `git`, Tailscale and so on isn't very onerous, and also helps me to remember to tidy the configuration.

## Resources

- Dotfiles: [dmadisetti], [Electrostasy], [reckenrode]
- Hyprland configs: [yurihikari], [Waayway]

[Waayway]: https://github.com/Waayway/hyprland-waayway
[yurihikari]: https://github.com/yurihikari/garuda-sway-config
[electrostasy]: https://github.com/Electrostasy/dots
[reckenrode]: https://github.com/reckenrode/nixos-configs
[dmadisetti]: https://github.com/dmadisetti/.dots
[work around]: https://discourse.nixos.org/t/dirty-nixos-rebuild-build-flake-issues/30078/2
[LVM over LUKS]: https://wiki.archlinux.org/title/dm-crypt/Encrypting_an_entire_system#LVM_on_LUKS
[installer]: https://channels.nixos.org/nixos-23.11/latest-nixos-minimal-x86_64-linux.iso
